<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Consultas MINEDU</title>

    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 384 512'%3E%3Cpath fill='%236366f1' d='M64 0C28.7 0 0 28.7 0 64V448c0 35.3 28.7 64 64 64H320c35.3 0 64-28.7 64-64V160H256c-17.7 0-32-14.3-32-32V0H64zM256 0V128H384L256 0zM112 256H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16zm0 64H272c8.8 0 16 7.2 16 16s-7.2 16-16 16H112c-8.8 0-16-7.2-16-16s7.2-16 16-16z'/%3E%3C/svg%3E">
</head>

<body>
    <!-- Main Content -->
    <main id="main-content" class="main-content">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-badge">
                    <i class="fa-solid fa-file-invoice-dollar"></i>
                    <span id="header-mode-text">Portal de Consultas</span>
                </div>

                <button id="admin-lock-btn" class="admin-lock-btn" title="Acceso Administrativo">
                    <i class="fa-solid fa-lock"></i>
                </button>
            </div>
        </header>

        <!-- Login Modal -->
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fa-solid fa-lock" style="margin-right: 0.5rem;"></i> Acceso Administrativo</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="admin-login-form">
                        <div class="form-group">
                            <label for="admin-password">Contraseña</label>
                            <input type="password" id="admin-password" class="form-input"
                                placeholder="Ingrese contraseña" autocomplete="current-password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">Ingresar</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Logout Confirmation Modal -->
        <div id="logout-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fa-solid fa-right-from-bracket" style="margin-right: 0.5rem;"></i> Cerrar Sesión</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro que deseas salir del modo administrador?</p>
                    <div class="form-actions"
                        style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button id="cancel-logout-btn" class="btn btn-secondary">Cancelar</button>
                        <button id="confirm-logout-btn" class="btn btn-primary"
                            style="background-color: var(--error);">Cerrar Sesión</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- User View (Default) -->
        <div id="user-view" class="view-container">
            <div class="search-container">
                <h1 class="search-title">Sistema de Consultas MINEDU</h1>
                <p class="search-subtitle">Consulta tu información por DNI</p>

                <!-- Camera Modal -->
                <div id="camera-modal" class="modal">
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header">
                            <h3><i class="fa-solid fa-camera" style="margin-right: 0.5rem;"></i> Tomar Foto de Boleta
                            </h3>
                            <button class="close-modal" id="close-camera-modal">&times;</button>
                        </div>
                        <div class="modal-body" style="text-align: center;">
                            <div class="video-container"
                                style="position: relative; width: 100%; padding-top: 75%; background: black; overflow: hidden; border-radius: 8px;">
                                <video id="camera-video" autoplay playsinline
                                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;"></video>
                                <canvas id="camera-canvas" style="display: none;"></canvas>
                            </div>
                            <div style="margin-top: 1rem; display: flex; justify-content: center; gap: 1rem;">
                                <button id="capture-btn" class="btn btn-primary btn-lg">Capturar Foto</button>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.8rem; color: #666;">Asegúrate que la boleta esté
                                bien iluminada.</p>
                        </div>
                    </div>
                </div>

                <form id="search-form" class="search-form">
                    <div class="search-box">
                        <input type="text" id="search-dni" class="search-input" placeholder="Ingrese su DNI (8 dígitos)"
                            maxlength="8" pattern="[0-9]{8}" required>
                        <button type="submit" class="search-btn">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                </form>

                <div class="pdf-upload-section" style="margin-top: 1.5rem; text-align: center;">
                    <p style="margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">¿Tienes tu boleta
                        en PDF o Foto?</p>
                    <input type="file" id="pdf-upload-input" accept="application/pdf, image/*" style="display: none;">
                    <button id="pdf-upload-btn" class="btn btn-secondary"
                        style="display: inline-flex; align-items: center; gap: 0.5rem;">
                        <i class="fa-regular fa-file-pdf"></i>
                        Evaluar Boleta (PDF / Imagen)
                    </button>
                    <button id="camera-btn" class="btn btn-primary"
                        style="display: inline-flex; align-items: center; gap: 0.5rem; margin-left: 0.5rem; background-color: var(--primary);">
                        <i class="fa-solid fa-camera"></i>
                    </button>
                </div>
            </div>

            <!-- Search Results -->
            <div id="search-results" class="search-results"></div>
        </div>

        <!-- Admin View -->
        <div id="admin-view" class="view-container" style="display: none;">
            <div class="tabs">
                <button class="tab-btn active" data-tab="upload"><i class="fa-solid fa-cloud-arrow-up"></i> Carga y
                    Sincronización</button>
                <button class="tab-btn" data-tab="quick-search"><i class="fa-solid fa-magnifying-glass"></i> Consulta
                    Rápida</button>
            </div>

            <!-- Upload Tab -->
            <div id="upload-tab" class="tab-content active">
                <div class="upload-section">
                    <div class="section-header">
                        <i class="fa-solid fa-cloud-arrow-up" style="font-size: 1.5rem;"></i>
                        <h3>Procesar Archivo Local (.lis)</h3>
                    </div>

                    <div class="file-upload-area">
                        <input type="file" id="file-input" accept=".lis,.txt" style="display: none;">
                        <button id="file-upload-btn" class="btn btn-upload">
                            Seleccionar Archivo
                        </button>
                        <p class="upload-hint">Formatos soportados: .lis, .txt</p>
                    </div>

                    <!-- File Processing Results -->
                    <div id="processing-results" class="processing-results"></div>
                </div>
            </div>

            <!-- Quick Search Tab -->
            <div id="quick-search-tab" class="tab-content">
                <div class="search-container">
                    <form id="admin-search-form" class="search-form">
                        <div class="search-box">
                            <input type="text" id="admin-search-dni" class="search-input"
                                placeholder="Ingrese DNI (8 dígitos)" maxlength="8" pattern="[0-9]{8}" required>
                            <button type="submit" class="search-btn">
                                <i class="fa-solid fa-magnifying-glass"></i>
                                Buscar
                            </button>
                        </div>
                    </form>
                </div>

                <div id="admin-search-results" class="search-results"></div>
            </div>
        </div>

        <!-- Footer -->
        <!--<footer class="footer">
            <p>&copy; 2024 Portal de Consultas. Todos los derechos reservados.</p>
        </footer> -->
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text">Cargando...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <!-- Tesseract.js (OCR) -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>

    <!-- Configuration -->
    <script src="config.js"></script>

    <!-- Utilities -->
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/parser.js"></script>
    <script src="assets/js/utils/pdf_parser.js"></script>
    <script src="assets/js/utils/supabase.js"></script>

    <!-- Components -->
    <script src="assets/js/components/search.js"></script>
    <script src="assets/js/components/admin.js"></script>
    <script src="assets/js/utils/credit_eval.js"></script>
    <script src="assets/js/components/viewer.js"></script>

    <!-- Main Application -->
    <script src="assets/js/app.js"></script>
</body>

</html>